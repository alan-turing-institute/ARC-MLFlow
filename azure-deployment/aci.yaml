apiVersion: '2019-12-01'
type: Microsoft.ContainerInstance/containerGroups
name: mlflow-aci
tags: {}
location: uksouth
properties:
  containers:
  - name: db
    properties:
      environmentVariables:
        - name: POSTGRES_USER
          value: <POSTGRES_USER>
        - name: POSTGRES_PASSWORD
          value: <POSTGRES_PASSWORD>
        - name: POSTGRES_DB
          value: <POSTGRES_DB>
      image: postgres
      ports:
      - port: 5432
      resources:
        requests:
          cpu: 1.0
          memoryInGB: 1.5
      volumeMounts:
      - mountPath: /var/lib/postgresql/data
        name: mlflowdb
  - name: mlflow
    properties:
      environmentVariables:
        - name: AZURE_STORAGE_CONNECTION_STRING
          value: <ARTIFACTS_AZURE_STORAGE_CONNECTION_STRING>
      command:
      - "mlflow server --backend-store-uri <DB_BACKEND_STORE_URI> --default-artifact-root <ARTIFACT_ROOT> --host 0.0.0.0 --serve-artifacts --port 5000"
      ports:
      - port: 5000
      resources:
        requests:
          cpu: 1.0
          memoryInGB: 1.5
  osType: Linux
  restartPolicy: Always
  ipAddress:
    type: Public
    ports:
      - port: 5000
    dnsNameLabel: mlflow-aci
  volumes:
    - name: mlflowdb
      azureFile:
        sharename: dbfileshare
        storageAccountName: <DB_STORAGE_ACCOUNT_NAME>
        storageAccountKey: <DB_STORAGE_ACCOUNT_KEY>
